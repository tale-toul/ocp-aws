---
- name: Assing a FQDN name to the bastion
  hosts: bastion
  tasks:
        - name: Assign a proper hostname to the server
          hostname:
              name: "{{ inventory_hostname }}"

- name: Prerequisites for OCP cluster members
  hosts: all
  tasks:
        - name: Find repo files
          find:
            paths: /etc/yum.repos.d
            patterns: '*.repo'
          register: repo_files
        - name: Disable rhui repositories
          command: mv {{ item.path }} {{ item.path }}.disabled
          when: "'rhui' in item.path"
          with_items: "{{ repo_files.files }}"
        - name: Register server with Red Hat
          redhat_subscription:
              state: present
              username: "{{ subscription_username }}"
              password: "{{ subscription_password }}"
              pool_ids: 8a85f9833e1404a9013e3cddf99305e6
        - name: Enable the required repositories for Openshift
          rhsm_repository:
              name: 
                - rhel-7-server-rpms
                - rhel-7-server-extras-rpms
                - rhel-7-server-ose-3.11-rpms
                - rhel-7-fast-datapath-rpms
                - rhel-7-server-ansible-2.6-rpms
              purge: True
#        - name: Update system packages
#          yum:
#              state: latest
#              name: '*'
...
